<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mia Chatbot</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" 
        href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
    <link rel="icon" type="image/x-icon" href="https://i.imgur.com/kj09wS4.png">
</head>
<body>
    <header>
        <img src="https://i.imgur.com/kj09wS4.png" alt="Iron Peak Roofing Logo" class="logo">
        <h1>Mia Chatbot</h1>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="form.html">Estimate Form</a></li>
                <li><a href="review.html">Review Estimate</a></li>
                <li><a href="mia.html">Mia Chatbot</a></li>
            </ul>
        </nav>
    </header>

    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

    <!-- Updated Dialogflow Messenger configuration -->
    <df-messenger
        project-id="ipr-roof-estimate-form-review"
        agent-id="5343493c-e057-445c-a767-86216ae1862d"
        language-code="en">
        <df-messenger-chat
            chat-title="Mia"
            placeholder-text="Ask me about roofing estimates..."
            chat-width="400"
            chat-height="500">
        </df-messenger-chat>
    </df-messenger>

    <style>
        df-messenger {
            z-index: 999;
            position: fixed;
            bottom: 16px;
            right: 16px;
            --df-messenger-bot-message: #878fac;
            --df-messenger-button-titlebar-color: #0056b3;
            --df-messenger-chat-background-color: #fafafa;
            --df-messenger-font-color: rgba(0, 0, 0, 0.87);
            --df-messenger-send-icon: #0056b3;
            --df-messenger-user-message: #0056b3;
            --df-messenger-minimize-icon-display: none;
        }
    </style>

    <main>
        <h2>Welcome to the Mia Chatbot Page!</h2>
        <p>This page will host the Mia chatbot for testing.</p>
    </main>

    <footer>
        <p>&copy; 2025 Iron Peak Roofing. All rights reserved.</p>
    </footer>

    <script>
        // Enhanced error handling
        window.addEventListener('df-messenger-error', function (event) {
            console.error('Dialogflow Messenger Error:', event.detail);
            
            // Log specific error details
            if (event.detail && event.detail.error) {
                const error = event.detail.error;
                console.error('Error Code:', error.code);
                console.error('Error Message:', error.message);
                console.error('Error Status:', error.status);
            }
        });

        // Add loaded event handler
        window.addEventListener('df-messenger-loaded', function (event) {
            console.log('Dialogflow Messenger loaded successfully');
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled Promise Rejection:', event.reason);
        });
    </script>
</body>
</html>
